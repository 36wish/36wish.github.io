<!doctype html>
<html lang='en'>
<head>
	<meta charset='utf-8'>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<title>jQuery UI Autocomplete - Remote datasource</title>
	<link rel='stylesheet' href='//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css'>
	<link rel='stylesheet' href='/resources/demos/style.css'>
	<style>
	.ui-autocomplete-loading {
		background: white url('images/ui-anim_basic_16x16.gif') right center no-repeat;
	}
	</style>
	<script src='https://code.jquery.com/jquery-3.3.1.js'></script>
	<script src='https://code.jquery.com/ui/1.12.1/jquery-ui.js'></script>
	<script>
	$( function() {
		function log( message ) {
			$( '<div>' ).text( message ).prependTo( '#log' );
			$( '#log' ).scrollTop( 0 );
		}
		function cho( id ) {
			$('.result').text('--')
			$.ajax({
				url: 'https://bb.code.kiwi/services/'+id,
				// data: {
				//   term: request.term
				// },
				success: function( data ) {
					console.log(data)
					$('#choru').text(JSON.stringify(data.locationProductAvailability))
					for (let service of data.locationProductAvailability){
						if (service.name == 'EUBA'){
							// console.log(!isNaN(service.unguaranteedDownloadSpeed))
							console.log(service.unguaranteedDownloadSpeed.trim().length > 0)
							if (service.unguaranteedDownloadSpeed.trim().length > 0){
								if (service.available == 'Y'){
									$('#adslavailable').text('Y')
									$('#adsltype').text('EUBA')
								} else{

									$('#adslavailable').text('Y')
									$('#adsltype').text('BUBA')
								}
							}else{
								$('#adslavailable').text('N	')
								$('#adsltype').text('')
							}
							
							$('#adsldown').text(service.unguaranteedDownloadSpeed)
							$('#adslup').text(service.unguaranteedUploadSpeed)
							$('#cabinet').text(service.centralOfficeCode)
							if (service.centralOfficeCode.trim().length > 0){
								$('#cabinetmaplink').show().attr('href',`https://gis.geek.nz/chorus/@${data.address.wgs84Latitude},${data.address.wgs84Longitude},16z`)
							}

						}
						if (service.name == 'WVS'){
							$('#vdslavailable').text(service.available)
							$('#vdsldown').text(service.unguaranteedDownloadSpeed)
							$('#vdslup').text(service.unguaranteedUploadSpeed)
						}
					}
					$('#bb').text(data.address.wgs84Latitude + ' ' + data.address.wgs84Longitude)
					$.ajax({
						url: `https://broadbandmap.nz/api/1.0/networks?x=${data.address.wgs84Longitude}&y=${data.address.wgs84Latitude}`,
						// data: {
						//   term: request.term
						// },
						success: function( data ) {
							console.log(data)
							// for(let tech in data.results){
							for(let i = 0, l = data.results.length; i < l; ++i){
								tech = data.results[i]
								// console.log(tech)
								if (tech.technology == 'Fibre'){
									$('#fibreavailable').text(tech.availability + ' ' + tech.completion)
									try{$('#fibreproviders').text(tech.providers.map(a=>a.name).join(', '))}catch(e){}
								}
								if (tech.technology == 'Wireless'){
									$('#wirelessavailable').text(tech.availability + ' ' + tech.completion)
									try{$('#wirelessproviders').text(tech.providers.map(a=>a.name).join(', '))}catch(e){}
								}
								if (tech.technology == 'Cable'){
									$('#cableavailable').text(tech.availability)

								}
							}
							
							
							$('#bb').text(JSON.stringify(data))
							// response( data[0]['results'] );
						}
					});
					// response( data[0]['results'] );
				}
			});
		}
		$( '#birds' ).autocomplete({
			source: function( request, response ) {
				$.ajax( {
				  url: 'https://addressright.co.nz/fuzzycomplete.json?api_key=278227_fie2iuwleqoEfrlu&per_page=5&term='+request.term,
				  // data: {
				  //   term: request.term
				  // },
				  success: function( data ) {
					// console.log(data)
					a = data[0]['results']
					console.log(a)
					response(a.map(a=>({id:a.id,label:a.label})));
				  }
				} );
			  }
			  // ['acc','bcc','ccc']

			,
			minLength: 2,
			select: function( event, ui ) {
				// console.log($('#birds').val())
				// $('#birds').autocomplete( "disable" )
				// $('#birds').val(ui.item.label)
				// $('#birds').autocomplete( "enable" )

				// console.log($('#birds').val())
				// $('#birds').val(ui.item.label)
				// $('#birds').val(ui.item.label)

				log( 'Address: ' + ui.item.label + ' ID: ' + ui.item.id );
				cho(ui.item.id.substr(1))
			}
		});
	} );
	</script>
</head>
<body>
 
<div class='ui-widget'>
	<label for='birds'>Addr: </label>
	<input id='birds'>
</div>
 
<div class='ui-widget' style='margin-top:2em; font-family:Arial'>

	<div>ADSL available: <span id='adslavailable' class='result'>--</span></div>
	<div>ADSL type: <span id='adsltype' class='result'>--</span></div>
	<div>ADSL Down: <span id='adsldown' class='result'>--</span></div>

	<div>ADSL Up: <span id='adslup' class='result'>--</span></div>
	</div>
<div class='ui-widget' style='margin-top:2em; font-family:Arial'>

	<div>VDSL available: <span id='vdslavailable' class='result'>--</span></div>

	<div>VDSL Down: <span id='vdsldown' class='result'>--</span></div>
	<div>VDSL Up: <span id='vdslup' class='result'>--</span></div>
	<div>DSL cabinet: <span id='cabinet' class='result'>--</span> <span id='cabinetmap'><a id='cabinetmaplink' style='display: none'>Cabinet Map</a></span></div>
</div>
<div class='ui-widget' style='margin-top:2em; font-family:Arial'>

	<div>Fibre: <span id='fibreavailable' class='result'>--</span></div>
	<div>Fibre provider(s): <span id='fibreproviders' class='result'>--</span></div>
	<div>Cable: <span id='cableavailable' class='result'>--</span></div>
	<div>Wireless: <span id='wirelessavailable' class='result'>--</span></div>
	<div>Wireless provider(s): <span id='wirelessproviders' class='result'>--</span></div>
</div>
<!-- 	Result:
	<div id='log' style='height: 200px; width: 300px; overflow: auto;' class='ui-widget-content'></div>
	<div id='choru' style='height: 200px; width: 300px; overflow: auto;' class='ui-widget-content'></div>
	<div id='bb' style='height: 200px; width: 300px; overflow: auto;' class='ui-widget-content'></div> -->

 
 
</body>
</html>